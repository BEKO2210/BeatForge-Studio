---
phase: 06-beat-reactivity
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/visualizers/WaveformVisualizer.tsx
  - src/visualizers/CircularSpectrumVisualizer.tsx
autonomous: false

must_haves:
  truths:
    - "Waveform visualizer pulses amplitude and glows on beats"
    - "Circular visualizer has smooth radius pulse and rotation boost on beats"
    - "All three visualizers feel tight and reactive to music"
  artifacts:
    - path: "src/visualizers/WaveformVisualizer.tsx"
      provides: "Beat-reactive waveform with glow and amplitude effects"
      min_lines: 80
    - path: "src/visualizers/CircularSpectrumVisualizer.tsx"
      provides: "Beat-reactive circular spectrum with eased radius pulse"
      min_lines: 180
  key_links:
    - from: "src/visualizers/WaveformVisualizer.tsx"
      to: "src/hooks/useBeatReaction.ts"
      via: "hook import"
      pattern: "useBeatReaction"
    - from: "src/visualizers/CircularSpectrumVisualizer.tsx"
      to: "src/hooks/useBeatReaction.ts"
      via: "hook import"
      pattern: "useBeatReaction"
---

<objective>
Complete beat reactivity for Waveform and Circular visualizers, then verify all visualizers feel tight with music.

Purpose: Ensure all three visualizers have smooth, punchy beat reactions that make the visuals "breathe with the music."
Output: Enhanced Waveform and Circular visualizers with beat effects, human-verified visual quality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-beat-reactivity/06-01-SUMMARY.md

@src/visualizers/WaveformVisualizer.tsx
@src/visualizers/CircularSpectrumVisualizer.tsx
@src/hooks/useBeatReaction.ts
@src/animation/easing.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add beat reactivity to WaveformVisualizer</name>
  <files>src/visualizers/WaveformVisualizer.tsx</files>
  <action>
Enhance Waveform with smooth beat-reactive effects:

1. Import useBeatReaction hook from '../hooks/useBeatReaction'
2. Use useBeatReaction with 200ms decay (slightly longer for waveform smoothness)

3. Add beat-reactive effects (controlled by reaction.value):

   **Amplitude pulse:** On beat, boost waveform amplitude:
   ```typescript
   const amplitudeBoost = 1 + reaction.value * 0.25; // Up to 25% taller on strong beat
   const effectiveAmplitude = amplitude * amplitudeBoost;
   ```

   **Line width pulse:** Already has basic beat effect, enhance with smooth decay:
   ```typescript
   const lineWidth = 2.5 + reaction.value * 2; // 2.5 → 4.5 on beat
   ```

   **Color saturation/brightness boost:** Shift from #00ff88 toward brighter on beat:
   ```typescript
   const hue = 150; // Green base
   const lightness = 50 + reaction.value * 20; // 50% → 70% on beat
   const lineColor = `hsl(${hue}, 85%, ${lightness}%)`;
   ```

   **Glow effect:** Add canvas shadow when reaction.value > 0.1:
   ```typescript
   if (reaction.value > 0.1) {
     ctx.shadowColor = '#00ff88';
     ctx.shadowBlur = reaction.value * 15;
   }
   // After drawing, clear: ctx.shadowBlur = 0;
   ```

4. Apply same effects (scaled down) to the mirror reflection

The waveform should feel like it "breathes" with the music - expanding and glowing on beats.
  </action>
  <verify>
- `npm run build` succeeds
- `npm run lint` passes
  </verify>
  <done>
- Waveform amplitude pulses smoothly on beats
- Line width and brightness increase on beat then decay
- Glow effect visible on beats
- Mirror reflection also responds (subtly)
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance beat reactivity in CircularSpectrumVisualizer</name>
  <files>src/visualizers/CircularSpectrumVisualizer.tsx</files>
  <action>
The Circular visualizer already has basic radius pulse (`radiusPulse = beat ? intensity * 15 : 0`), but it's abrupt. Enhance with smooth easing:

1. Import useBeatReaction hook from '../hooks/useBeatReaction'
2. Use useBeatReaction with 180ms decay (medium - circular needs responsive feel)

3. Replace abrupt radius pulse with smooth eased version:
   ```typescript
   // OLD: const radiusPulse = beat ? intensity * 15 : 0;
   // NEW:
   const radiusPulse = reaction.value * 20; // Smooth 0-20px pulse
   ```

4. Add rotation speed boost on beat (temporary acceleration):
   ```typescript
   // Boost rotation speed on beat
   const rotationBoost = 1 + reaction.value * 0.5; // Up to 50% faster momentarily
   const effectiveRotation = rotation + reaction.value * 0.1; // Small jump forward
   ```

5. Add line width boost for current frame on beat:
   ```typescript
   const currentLineWidth = 2.5 + reaction.value * 1.5; // 2.5 → 4 on beat
   ```

6. Add center glow effect:
   ```typescript
   if (reaction.value > 0.15) {
     // Draw glowing center circle
     const glowRadius = effectiveRadius * 0.8;
     const gradient = ctx.createRadialGradient(
       centerX, centerY, 0,
       centerX, centerY, glowRadius
     );
     gradient.addColorStop(0, `rgba(255, 255, 255, ${reaction.value * 0.3})`);
     gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
     ctx.fillStyle = gradient;
     ctx.beginPath();
     ctx.arc(centerX, centerY, glowRadius, 0, Math.PI * 2);
     ctx.fill();
   }
   ```

The circular visualizer should feel like it "pulses outward" and briefly accelerates on each beat.
  </action>
  <verify>
- `npm run build` succeeds
- `npm run lint` passes
  </verify>
  <done>
- Circular radius pulse is smooth (eased decay, not binary)
- Center glow appears on beats
- Line width increases on beat
- Overall feel is punchy but smooth
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Beat reactivity system with smooth animations across all three visualizers:
- Equalizer: brightness/scale/glow pulse on beats
- Waveform: amplitude/width/color/glow pulse on beats
- Circular: radius/rotation/linewidth/glow pulse on beats
</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: http://localhost:5173 (or configured port)
    3. Upload a song with clear beat (EDM, hip-hop, rock work well)
    4. Press play and observe each visualizer:

    **For Equalizer:**
    - Watch the spectrogram on bass hits
    - Should see brief brightness boost and subtle scale increase
    - Effect should decay smoothly over ~150ms

    **For Waveform:**
    - Watch the waveform line on beats
    - Should see amplitude increase, line thicken, and glow appear
    - Effect should decay smoothly over ~200ms

    **For Circular:**
    - Watch the circle on beats
    - Should see radius expand outward, brief rotation acceleration
    - Center should glow on strong beats
    - Effect should decay smoothly over ~180ms

    5. Critical check: Effects should feel "tight" with the music:
       - Beat hits → immediate visual response (low latency)
       - Not jarring or choppy
       - Smooth decay, not binary on/off

    6. Try different music genres to verify adaptability
  </how-to-verify>
  <resume-signal>Type "approved" if all visualizers feel tight and reactive, or describe specific issues (e.g., "waveform feels too subtle", "circular decay too slow")</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] Waveform has smooth beat-reactive effects
- [ ] Circular has smooth beat-reactive effects
- [ ] Human verified: all three visualizers feel tight with music
</verification>

<success_criteria>

- All tasks completed
- Waveform pulses amplitude, width, and glows on beats
- Circular has smooth radius pulse and center glow
- Human verified visual tightness with music
- Beat reactivity feels punchy with smooth decay
- No regressions - temporal flow effects preserved
  </success_criteria>

<output>
After completion, create `.planning/phases/06-beat-reactivity/06-02-SUMMARY.md`
</output>
