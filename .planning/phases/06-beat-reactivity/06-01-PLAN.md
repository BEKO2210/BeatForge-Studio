---
phase: 06-beat-reactivity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/animation/easing.ts
  - src/animation/index.ts
  - src/hooks/useBeatReaction.ts
  - src/visualizers/EqualizerVisualizer.tsx
autonomous: true

must_haves:
  truths:
    - "Beat reactions have smooth attack and decay (not binary on/off)"
    - "Equalizer visually pulses on beats with configurable intensity"
    - "Animation values ease out naturally over configurable duration"
  artifacts:
    - path: "src/animation/easing.ts"
      provides: "Easing functions for beat animations"
      exports: ["easeOutQuad", "easeOutCubic", "easeOutExpo"]
    - path: "src/hooks/useBeatReaction.ts"
      provides: "React hook for smooth beat-reactive values"
      exports: ["useBeatReaction"]
  key_links:
    - from: "src/visualizers/EqualizerVisualizer.tsx"
      to: "src/hooks/useBeatReaction.ts"
      via: "hook import"
      pattern: "useBeatReaction"
---

<objective>
Create animation easing system and integrate beat reactivity into the Equalizer visualizer.

Purpose: Establish the foundation for smooth, punchy beat reactions across all visualizers. Currently beat reactions are binary (on/off) - this adds proper attack/decay curves.
Output: Animation utilities, useBeatReaction hook, and enhanced Equalizer with smooth beat pulses.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-visualizers/05-03-SUMMARY.md

@src/visualizers/EqualizerVisualizer.tsx
@src/visualizers/types.ts
@src/hooks/useBeatDetector.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create animation easing utilities</name>
  <files>src/animation/easing.ts, src/animation/index.ts</files>
  <action>
Create easing functions for beat animations:

1. Create `src/animation/easing.ts` with standard easing curves:
   - `easeOutQuad(t: number): number` - t^2 curve, gentle decay
   - `easeOutCubic(t: number): number` - t^3 curve, medium decay
   - `easeOutExpo(t: number): number` - exponential, punchy with fast attack and slow tail
   - `easeInOutSine(t: number): number` - smooth S-curve for subtle effects

2. Add `decay(elapsed: number, duration: number, easing: EasingFn): number` helper:
   - Returns 1.0 at elapsed=0, decays to 0 at elapsed>=duration
   - Uses provided easing function for the decay curve

3. Create `src/animation/index.ts` barrel export

All functions are pure (no side effects), take t in 0-1 range, return 0-1 range.

Note: Use standard easing formulas (e.g., easeOutQuad = 1 - (1-t)^2). Do NOT use any external animation library.
  </action>
  <verify>
- `npx tsc --noEmit` passes
- Import works: `import { easeOutExpo, decay } from './animation'`
  </verify>
  <done>
- Easing functions exported from src/animation/
- decay() helper computes smooth decay values
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useBeatReaction hook</name>
  <files>src/hooks/useBeatReaction.ts</files>
  <action>
Create a React hook that converts discrete beat events into smooth animated values:

```typescript
interface UseBeatReactionOptions {
  /** Decay duration in ms (default: 150) */
  decayMs?: number;
  /** Easing function for decay (default: easeOutExpo) */
  easing?: (t: number) => number;
  /** Minimum intensity threshold to trigger (default: 0) */
  threshold?: number;
}

interface UseBeatReactionResult {
  /** Current animation value 0-1, peaks on beat then decays */
  value: number;
  /** Whether currently in decay phase */
  isActive: boolean;
}
```

Implementation approach:
1. When isBeat becomes true AND intensity >= threshold, capture intensity and current timestamp
2. On each animation frame, calculate elapsed time since beat
3. Return `intensity * decay(elapsed, decayMs, easing)`
4. Use requestAnimationFrame loop for smooth updates
5. Cleanup properly on unmount

Key behaviors:
- New beats interrupt ongoing decay (restart from new intensity)
- Returns 0 when no active decay
- isActive true while value > 0.01

Do NOT use external animation libraries. Pure TypeScript + React.
  </action>
  <verify>
- `npx tsc --noEmit` passes
- Hook can be imported and used in a component
  </verify>
  <done>
- useBeatReaction hook exported from src/hooks/
- Converts discrete isBeat/intensity into smooth decaying value
- Uses requestAnimationFrame for smooth 60fps updates
  </done>
</task>

<task type="auto">
  <name>Task 3: Add beat reactivity to EqualizerVisualizer</name>
  <files>src/visualizers/EqualizerVisualizer.tsx</files>
  <action>
Enhance the Equalizer with smooth beat-reactive effects:

1. Import and use `useBeatReaction` hook:
   - Pass isBeat and beatIntensity from props
   - Use 150ms decay with easeOutExpo for punchy feel

2. Add beat-reactive effects (controlled by reaction.value):
   - **Brightness pulse**: On beat, increase cell brightness by up to 40% (current code has basic brightness boost, enhance it)
   - **Scale pulse**: On beat, slightly increase cell height (multiply by 1 + reaction.value * 0.15)
   - **Glow effect**: Add subtle canvas shadow/glow on recent columns when reaction.value > 0.1:
     ```typescript
     if (reaction.value > 0.1) {
       ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';
       ctx.shadowBlur = reaction.value * 10;
     }
     ```
   - Clear shadow after drawing: `ctx.shadowBlur = 0;`

3. Accept beatIntensity prop (already in VisualizerProps but not used) and pass to useBeatReaction

4. Keep existing temporal scrolling spectrogram behavior - beat effects ADD to it, don't replace it

The effect should feel: fast attack (beat hits hard), smooth decay (energy dissipates naturally), not jarring.
  </action>
  <verify>
- `npm run build` succeeds
- `npm run lint` passes
- Play audio and observe Equalizer pulses smoothly on beats
  </verify>
  <done>
- Equalizer brightness increases smoothly on beat then fades
- Scale effect adds subtle size boost on beat
- Glow effect visible on strong beats
- Animation feels punchy with smooth decay
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] Animation utilities compile and export correctly
- [ ] useBeatReaction hook produces smooth values (not binary)
- [ ] Equalizer has visible, smooth beat reactions
</verification>

<success_criteria>

- All tasks completed
- Animation easing system created with standard curves
- useBeatReaction hook converts discrete beats to smooth values
- Equalizer pulses visibly on beats with smooth decay
- No regressions - existing visualizer behavior preserved
  </success_criteria>

<output>
After completion, create `.planning/phases/06-beat-reactivity/06-01-SUMMARY.md`
</output>
