---
phase: 12-platform-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/tier/types.ts
  - src/tier/TierContext.tsx
  - src/tier/index.ts
  - src/components/Watermark.tsx
  - src/components/Watermark.css
  - src/visualizers/VisualizerContainer.tsx
  - src/components/ExportPanel.tsx
autonomous: true

must_haves:
  truths:
    - "Free tier shows watermark on canvas"
    - "Free tier limits export to 720p"
    - "Pro tier removes watermark"
    - "Pro tier unlocks 1080p export"
  artifacts:
    - path: "src/tier/types.ts"
      provides: "Tier type definitions"
      contains: "TierLevel"
    - path: "src/tier/TierContext.tsx"
      provides: "React context for tier state"
      exports: ["TierProvider", "useTier"]
    - path: "src/components/Watermark.tsx"
      provides: "Watermark overlay component"
  key_links:
    - from: "src/visualizers/VisualizerContainer.tsx"
      to: "src/components/Watermark.tsx"
      via: "renders Watermark when free tier"
    - from: "src/components/ExportPanel.tsx"
      to: "src/tier/TierContext.tsx"
      via: "useTier hook for resolution limits"
---

<objective>
Implement tier system with free/pro distinction, watermark for free tier, and export resolution limits.

Purpose: Enable monetization structure with clear value differentiation between tiers.
Output: Tier context, watermark component, and tier-aware export limits.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/App.tsx
@src/components/ExportPanel.tsx
@src/visualizers/VisualizerContainer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tier types and context</name>
  <files>src/tier/types.ts, src/tier/TierContext.tsx, src/tier/index.ts</files>
  <action>
    1. Create src/tier/types.ts:
       - TierLevel: 'free' | 'pro'
       - TierConfig: { level, maxResolution, showWatermark, features[] }
       - FREE_TIER_CONFIG: maxResolution 720, showWatermark true
       - PRO_TIER_CONFIG: maxResolution 1080, showWatermark false

    2. Create src/tier/TierContext.tsx:
       - TierContext with current tier state
       - TierProvider component
       - useTier() hook returning { tier, setTier, config }
       - Default to 'free' tier
       - For now, tier is stored in React state only (no persistence/payment)
       - Add simple toggle function for demo purposes

    3. Create src/tier/index.ts:
       - Export all types and context hooks

    Note: Actual payment integration is out of scope per PROJECT.md.
    The tier can be toggled for demo/testing purposes.
  </action>
  <verify>TypeScript compiles with no errors</verify>
  <done>Tier types and context created with free/pro configurations</done>
</task>

<task type="auto">
  <name>Task 2: Create watermark component</name>
  <files>src/components/Watermark.tsx, src/components/Watermark.css</files>
  <action>
    1. Create src/components/Watermark.tsx:
       - Overlay div positioned absolute over canvas
       - Text: "BeatForge Studio" with subtle styling
       - Position: bottom-right corner
       - Styling: semi-transparent white text, small font (12-14px)
       - pointer-events: none (doesn't block interaction)
       - Optional: Add small "Free" badge or "Upgrade to remove" text

    2. Create src/components/Watermark.css:
       - .watermark class with absolute positioning
       - Semi-transparent background for readability
       - Subtle but visible (not intrusive but clear it's there)
       - Use z-index to appear above canvas but below UI

    Avoid: Don't make watermark too intrusive - should be professional.
  </action>
  <verify>Watermark component renders without errors</verify>
  <done>Watermark component ready for integration</done>
</task>

<task type="auto">
  <name>Task 3: Integrate tier system into App and components</name>
  <files>src/App.tsx, src/visualizers/VisualizerContainer.tsx, src/components/ExportPanel.tsx</files>
  <action>
    1. Update src/App.tsx:
       - Wrap app content with TierProvider
       - Add tier toggle button in header (temporary, for demo/testing)
       - Style toggle to show current tier status

    2. Update src/visualizers/VisualizerContainer.tsx:
       - Import useTier hook
       - Conditionally render Watermark component when tier.showWatermark is true
       - Position Watermark inside canvas-wrapper, after canvas

    3. Update src/components/ExportPanel.tsx:
       - Import useTier hook
       - Filter resolution options based on tier.maxResolution
       - For free tier: only show 720p option
       - For pro tier: show both 720p and 1080p
       - Add visual indicator showing tier limitation ("Pro: Unlock 1080p")

    Avoid: Don't add payment logic - just tier-based feature gating.
  </action>
  <verify>npm run build succeeds, watermark shows for free tier</verify>
  <done>Tier system integrated, watermark shows for free tier, export limited</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Watermark visible on canvas when in free tier
- [ ] Watermark hidden when in pro tier (via toggle)
- [ ] Export panel shows only 720p for free tier
- [ ] Export panel shows both resolutions for pro tier
</verification>

<success_criteria>

- All tasks completed
- Tier context provides tier state throughout app
- Watermark renders on canvas for free tier users
- Export resolution properly limited by tier
- Toggle allows switching tiers for demonstration
  </success_criteria>

<output>
After completion, create `.planning/phases/12-platform-polish/12-02-SUMMARY.md`
</output>
