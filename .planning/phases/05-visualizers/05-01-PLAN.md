---
phase: 05-visualizers
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/audio/BeatDetector.ts
  - src/visualizers/types.ts
autonomous: true

must_haves:
  truths:
    - "BeatDetector exposes raw frequency data array"
    - "BeatDetector exposes time domain data for waveform"
    - "Visualizer types define consistent interface"
  artifacts:
    - path: "src/audio/BeatDetector.ts"
      provides: "getFrequencyData() and getTimeDomainData() methods"
      contains: "getFrequencyData"
    - path: "src/visualizers/types.ts"
      provides: "VisualizerProps interface"
      exports: ["VisualizerProps"]
  key_links:
    - from: "BeatDetector.getFrequencyData()"
      to: "this.frequencyData"
      via: "returns normalized copy of internal array"
---

<objective>
Extend BeatDetector with raw audio data access and create visualizer type definitions.

Purpose: Visualizers need access to full frequency spectrum (not just 3 bands) and time domain waveform data. This plan establishes the data foundation all visualizers will use.
Output: Extended BeatDetector with data access methods, visualizer type definitions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-beat-detection/03-01-SUMMARY.md
@.planning/phases/04-canvas-renderer/04-01-SUMMARY.md

@src/audio/BeatDetector.ts
@src/audio/types.ts
@src/renderer/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend BeatDetector with raw data access</name>
  <files>src/audio/BeatDetector.ts</files>
  <action>
Add two new public methods to BeatDetector:

1. `getFrequencyData(): Float32Array` - Returns normalized (0-1) frequency data
   - Create a Float32Array from this.frequencyData
   - Normalize each value by dividing by 255
   - Return the normalized array
   - Note: Reuse internal frequencyData (already populated by getBeatInfo/getFrequencyBands)

2. `getTimeDomainData(): Float32Array` - Returns normalized (-1 to 1) waveform data
   - Create new Uint8Array for time domain data
   - Call this.analyser.getByteTimeDomainData()
   - Normalize from 0-255 to -1 to 1 range: (value - 128) / 128
   - Return the normalized array

Both methods should be efficient for 60 FPS calling. The frequency data is already computed each frame by getBeatInfo(), so getFrequencyData() just normalizes the existing data. Time domain data is separate and computed on demand.
  </action>
  <verify>npm run build succeeds, TypeScript compiles without errors</verify>
  <done>BeatDetector has getFrequencyData() and getTimeDomainData() methods that return normalized arrays</done>
</task>

<task type="auto">
  <name>Task 2: Create visualizer type definitions</name>
  <files>src/visualizers/types.ts</files>
  <action>
Create new file src/visualizers/types.ts with:

1. `VisualizerType` - Union type: 'equalizer' | 'waveform' | 'circular'

2. `VisualizerProps` interface:
   - renderer: Renderer | null - The canvas renderer instance
   - frequencyData: Float32Array | null - Normalized 0-1 frequency spectrum
   - timeDomainData: Float32Array | null - Normalized -1 to 1 waveform
   - isBeat: boolean - Whether a beat was detected this frame
   - beatIntensity: number - Beat intensity 0-1
   - width: number - Canvas logical width
   - height: number - Canvas logical height

3. `VisualizerConfig` interface:
   - type: VisualizerType
   - color?: string - Primary color (default varies by visualizer)
   - barCount?: number - For equalizer, number of bars (default 64)
   - lineWidth?: number - For waveform/circular line thickness

Export all types.
  </action>
  <verify>npm run build succeeds, types are exported correctly</verify>
  <done>src/visualizers/types.ts exists with VisualizerProps, VisualizerType, VisualizerConfig exported</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes (or only pre-existing warnings)
- [ ] BeatDetector.getFrequencyData() returns Float32Array
- [ ] BeatDetector.getTimeDomainData() returns Float32Array
- [ ] src/visualizers/types.ts exports VisualizerProps interface
</verification>

<success_criteria>
- All tasks completed
- BeatDetector exposes raw frequency and time domain data
- Visualizer types provide consistent interface for all visualizers
- No new TypeScript or lint errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/05-visualizers/05-01-SUMMARY.md`
</output>
