---
phase: 05-visualizers
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - src/visualizers/VisualizerContainer.tsx
  - src/visualizers/index.ts
  - src/App.tsx
  - src/App.css
autonomous: false

must_haves:
  truths:
    - "User can see visualizer responding to audio"
    - "User can switch between equalizer, waveform, and circular visualizers"
    - "All visualizers stay synced with audio playback"
    - "Visualizers render at 60 FPS without lag"
  artifacts:
    - path: "src/visualizers/VisualizerContainer.tsx"
      provides: "Container that hosts visualizers with selector"
      min_lines: 60
    - path: "src/visualizers/index.ts"
      provides: "Barrel export for visualizer module"
  key_links:
    - from: "VisualizerContainer"
      to: "useBeatDetector hook"
      via: "gets beatInfo for isBeat/intensity"
    - from: "VisualizerContainer"
      to: "BeatDetector.getFrequencyData()"
      via: "polls each frame for visualizer data"
    - from: "App.tsx"
      to: "VisualizerContainer"
      via: "renders container with audioEngine prop"
---

<objective>
Create VisualizerContainer component and integrate all visualizers into the main App.

Purpose: Users need a unified interface to view and switch between visualizers. This completes the Phase 5 user experience.
Output: Working visualizer system integrated into App with selector UI.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-visualizers/05-01-SUMMARY.md
@.planning/phases/05-visualizers/05-02-SUMMARY.md

@src/visualizers/types.ts
@src/visualizers/EqualizerVisualizer.tsx
@src/visualizers/WaveformVisualizer.tsx
@src/visualizers/CircularSpectrumVisualizer.tsx
@src/hooks/useRenderer.ts
@src/hooks/useBeatDetector.ts
@src/App.tsx
@src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VisualizerContainer component</name>
  <files>src/visualizers/VisualizerContainer.tsx, src/visualizers/index.ts</files>
  <action>
Create VisualizerContainer.tsx:

Props:
- audioEngine: AudioEngine | null
- className?: string

State:
- selectedVisualizer: VisualizerType (default 'equalizer')

Implementation:
1. Use useRenderer hook to get renderer and canvasRef
2. Use useBeatDetector hook to get beatInfo (for isBeat, intensity)
3. Create refs for storing frequency/time domain data (updated each frame)
4. Use useEffect with requestAnimationFrame to poll BeatDetector for raw data:
   - Get beatDetector from audioEngine
   - Call getFrequencyData() and getTimeDomainData() each frame
   - Store in refs (avoid re-renders on every frame)
5. Pass data to currently selected visualizer via VisualizerProps

Render:
- Canvas element (from useRenderer)
- Visualizer selector buttons (Equalizer | Waveform | Circular)
- Conditionally render selected visualizer component
- Style selector as pill buttons above canvas

Create src/visualizers/index.ts barrel export:
- Export all visualizer components
- Export VisualizerContainer
- Export types
  </action>
  <verify>npm run build succeeds, component renders selector and canvas</verify>
  <done>VisualizerContainer hosts visualizers with working selector UI</done>
</task>

<task type="auto">
  <name>Task 2: Integrate VisualizerContainer into App</name>
  <files>src/App.tsx, src/App.css</files>
  <action>
Update App.tsx:
1. Import VisualizerContainer from './visualizers'
2. Remove the existing demo canvas and its render callback (from Phase 4)
3. Remove BeatDebug component (from Phase 3) - visualizers replace it
4. Add VisualizerContainer component:
   - Pass audioEngine prop
   - Position below audio controls
   - Full width of main container

Update App.css:
1. Add styles for visualizer container section
2. Remove old .canvas-container demo styles if present
3. Style visualizer selector buttons:
   - Horizontal pill buttons
   - Active state highlighted
   - Subtle hover effect

Layout should be:
- Audio upload at top (when no file)
- Audio player controls (when file loaded)
- Visualizer container with selector + canvas (when file loaded)
  </action>
  <verify>npm run build succeeds, App renders with visualizer container</verify>
  <done>App.tsx integrates VisualizerContainer, demo canvas and BeatDebug removed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete visualizer system with equalizer, waveform, and circular spectrum</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:5173
    3. Upload an audio file (MP3 or WAV with clear beat)
    4. Play the audio
    5. Verify Equalizer visualizer:
       - Bars move up/down with audio frequencies
       - Bass frequencies (left) respond to bass notes
       - High frequencies (right) respond to hi-hats/cymbals
    6. Click "Waveform" selector button:
       - Waveform line oscillates with audio
       - Smooth animation, no jitter
    7. Click "Circular" selector button:
       - Radial pattern pulses with music
       - Lines extend outward based on frequency
    8. Verify all visualizers:
       - 60 FPS (smooth, no stuttering)
       - In sync with audio (no visible delay)
       - Canvas resizes responsively if window resized
  </how-to-verify>
  <resume-signal>Type "approved" if all visualizers work correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes (or only pre-existing warnings)
- [ ] VisualizerContainer renders with selector and canvas
- [ ] All three visualizers can be selected and display correctly
- [ ] Visualizers respond to audio in real-time
- [ ] Human verification passed
</verification>

<success_criteria>
- All tasks completed
- User can switch between three visualizers
- All visualizers sync with audio playback
- 60 FPS performance maintained
- Human approved visual quality
</success_criteria>

<output>
After completion, create `.planning/phases/05-visualizers/05-03-SUMMARY.md`
</output>
