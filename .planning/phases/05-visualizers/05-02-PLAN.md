---
phase: 05-visualizers
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/visualizers/EqualizerVisualizer.tsx
  - src/visualizers/WaveformVisualizer.tsx
  - src/visualizers/CircularSpectrumVisualizer.tsx
autonomous: true

must_haves:
  truths:
    - "Equalizer bars render frequency data as vertical bars"
    - "Waveform visualizer draws audio wave shape"
    - "Circular spectrum renders frequency as radial pattern"
  artifacts:
    - path: "src/visualizers/EqualizerVisualizer.tsx"
      provides: "Frequency bar visualization"
      min_lines: 40
    - path: "src/visualizers/WaveformVisualizer.tsx"
      provides: "Waveform line visualization"
      min_lines: 40
    - path: "src/visualizers/CircularSpectrumVisualizer.tsx"
      provides: "Radial frequency visualization"
      min_lines: 50
  key_links:
    - from: "EqualizerVisualizer"
      to: "frequencyData prop"
      via: "samples frequency bins to draw bars"
    - from: "WaveformVisualizer"
      to: "timeDomainData prop"
      via: "draws connected line from waveform samples"
    - from: "CircularSpectrumVisualizer"
      to: "frequencyData prop"
      via: "draws radial lines from center"
---

<objective>
Create the three core visualizers: equalizer bars, waveform, and circular spectrum.

Purpose: These are the primary visual representations of audio data that users will see. Each offers a distinct aesthetic (VIS-01, VIS-02, VIS-03).
Output: Three functional visualizer components using the Renderer callback pattern.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-visualizers/05-01-SUMMARY.md

@src/visualizers/types.ts
@src/renderer/Renderer.ts
@src/renderer/shapes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EqualizerVisualizer component</name>
  <files>src/visualizers/EqualizerVisualizer.tsx</files>
  <action>
Create EqualizerVisualizer React component:

Props: VisualizerProps (from types.ts)

Implementation:
1. Use useEffect to register render callback with renderer.onRender()
2. In render callback:
   - If no frequencyData, return early
   - Calculate barCount (default 64) and barWidth based on canvas width
   - Sample frequencyData evenly (frequencyData.length / barCount stride)
   - For each bar:
     - Calculate height from normalized value (0-1) * canvas height * 0.8
     - Use gradient color based on frequency: low = red/orange, mid = green, high = blue/purple
     - Draw bar using ctx.fillRect (bottom-aligned)
     - Add 2px gap between bars
3. Clean up: return unsubscribe from useEffect

Visual style:
- Bars grow upward from bottom
- Rounded top corners (cornerRadius: 2)
- Color gradient: #ff4444 (bass) -> #44ff44 (mid) -> #4444ff (treble)
- Slight glow effect on beat (increase brightness when isBeat)

Use drawRect from shapes.ts for bars.
  </action>
  <verify>npm run build succeeds, component exports correctly</verify>
  <done>EqualizerVisualizer renders frequency bars that respond to audio data</done>
</task>

<task type="auto">
  <name>Task 2: Create WaveformVisualizer component</name>
  <files>src/visualizers/WaveformVisualizer.tsx</files>
  <action>
Create WaveformVisualizer React component:

Props: VisualizerProps (from types.ts)

Implementation:
1. Use useEffect to register render callback with renderer.onRender()
2. In render callback:
   - If no timeDomainData, return early
   - Set up canvas path for waveform line
   - Calculate step size to sample ~200-400 points across width
   - For each sample point:
     - x = index * (width / sampleCount)
     - y = centerY + (timeDomainData[i] * amplitude)
     - amplitude = height * 0.4 (so wave uses 80% of height total)
   - Draw as connected line using ctx.beginPath(), moveTo, lineTo, stroke
3. Clean up: return unsubscribe from useEffect

Visual style:
- Centered vertically (wave oscillates around center)
- Line color: #00ff88 (cyan-green)
- Line width: 2-3px
- Optional: Add subtle mirror reflection below center (0.3 opacity)
- On beat: line gets slightly thicker or brighter

Do NOT use drawLine from shapes.ts (it's for single lines). Use native ctx path drawing for connected waveform.
  </action>
  <verify>npm run build succeeds, component exports correctly</verify>
  <done>WaveformVisualizer renders audio waveform as continuous line</done>
</task>

<task type="auto">
  <name>Task 3: Create CircularSpectrumVisualizer component</name>
  <files>src/visualizers/CircularSpectrumVisualizer.tsx</files>
  <action>
Create CircularSpectrumVisualizer React component:

Props: VisualizerProps (from types.ts)

Implementation:
1. Use useEffect to register render callback with renderer.onRender()
2. In render callback:
   - If no frequencyData, return early
   - Calculate center point (width/2, height/2)
   - Calculate baseRadius (min(width, height) * 0.15)
   - Calculate maxBarLength (min(width, height) * 0.3)
   - Sample ~128 frequency bins evenly around circle
   - For each sample:
     - angle = (i / sampleCount) * Math.PI * 2
     - barLength = frequencyData[binIndex] * maxBarLength
     - innerX/Y = center + cos/sin(angle) * baseRadius
     - outerX/Y = center + cos/sin(angle) * (baseRadius + barLength)
     - Draw line from inner to outer point
3. Clean up: return unsubscribe from useEffect

Visual style:
- Circle centered in canvas
- Lines radiate outward from inner circle
- Color gradient around circle (rainbow or frequency-based)
- Line width: 2-3px
- On beat: baseRadius pulses slightly larger (beatIntensity * 10px)
- Optional: Draw faint inner circle as reference

Use native ctx path drawing. Each radial line is a separate stroke.
  </action>
  <verify>npm run build succeeds, component exports correctly</verify>
  <done>CircularSpectrumVisualizer renders frequency as radial pattern</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes (or only pre-existing warnings)
- [ ] All three visualizer components export correctly
- [ ] Each visualizer uses the Renderer callback pattern
- [ ] Each visualizer handles null data gracefully (no crashes)
</verification>

<success_criteria>
- All tasks completed
- Three visualizer components created with consistent pattern
- Each visualizer renders appropriate visual representation
- No TypeScript or lint errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/05-visualizers/05-02-SUMMARY.md`
</output>
